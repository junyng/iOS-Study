# Supporting Drag and Drop in Table Views

테이블 뷰에서 drag & drop을 시작한다.

## Overview

테이블 뷰는 표시 중인 행과 함께 작동하는 전문화된 API drag & drop을 지원한다. 드래그를 지원하려면 드래그 위임 객체 - `UITableViewDragDelegate` 프로토콜을 채택한 객체를 정의하고 테이블 뷰의 `dragDelegate` 프로퍼티에 할당하라. 드랍을 처리하려면 드랍 위임 객체 - `UITableViewDropDelegate` 프로토콜을 채택한 객체를 정의하고 테이블 뷰의 `dropDelegate` 프로퍼티에 할당하라.

### Dragging Rows from the Table View

테이블 뷰는 대부분의 드래그 관련 상호 작용을 관리하지만 드래그 할 행을 지정해야 한다. 드래그 제스처가 발생하면 테이블 뷰는 드래그 세션을 생성하고 드래그 위임 객체의 `tableView(_:itemsForBeginning:at:)` 메서드를 호출한다. \(사용자가 선택한 행을 드래그할 때, 이 메서드는 선택에서 각 행에 대해 한번 호출한다. 아무런 행이 선택되지 않은 경우, 메서드는 기본 행에 대해 한 번만 호출된다.\) 만약 비어있는 배열을 리턴하면 테이블 뷰가 지정한 행을 드래그하기 시작한다. 사용자가 지정된 인덱스 경로에서 콘텐츠를 드래그 할 수 없는 경우 빈 배열을 반환하라.

> **Note**
>
> 추가 드래그 관련 인터랙션을 관리하려면 `UITableViewDragDelegate` 프로토콜의 다른 메서드를 사용하라. 예를 들어, 드래그 하려는 행의 모양을 사용자 정의하고 사용자가 현재 드래그 세션에 항목을 추가하도록 할 수 있다.

`tableView(_:itemsForBeginning:at:)` 메서드의 구현에서 다음을 수행하라.

1. `NSItemProvider` 객체를 하나 이상 생성하라. 테이블 행의 데이터를 나타내려면 항목 프로바이더를 사용하라.
2. 각 항목 제공자 객체를 `UIDragItem` 객체에 감싸라.
3. 각 드래그 항목의 `localObject` 프로퍼티에 값을 할당하는 것을 고려하라.
4. 드래그 항목을 메서드에서 반환하라.

제공된 인덱스 경로를 사용하려 드래그 항목을 생성할 행을 결정하라. 대상 행이 현재 선택된 행 중 하나일 경우, 테이블 뷰가 선택한 모든 행을 자동으로 끌어다 놓는다. 행이 현재 선택 항목에 포함되지 않은 경우 테이블 뷰는 이미 활성화된 드래그 작업에 이를 추가한다.

드래그 시작에 대한 자세한 내용은 `UITableViewDragDelegate` 를 참조 하라.

### Receiving Dropped Content

콘텐츠가 bounds 내에서 드래그되면 테이블 뷰는 드롭 delegate와 상의하여 드래그한 데이터를 수신할 수 있는지 여부를 결정한다. 처음에 테이블 뷰는 지정된 데이터를 데이터 소스에 통합할 수 있는지 여부를 결정하기 위해 드랍 델리게이트의 `tableView(_:canHandle:)` 메서드만 호출한다. 데이터를 통합할 수 있는 경우 테이블 뷰는 데이터를 삭제할 수 있는 위치를 결정하기 위해 다른 메서드를 호출하기 시작한다.

사용자가 손가락을 움직이면 테이블 뷰가 잠재적 드랍 위치를 추적한다. 그리고 각 변경 사항에 대해 `tableView(_:dropSessionDidUpdate:withDestinationIndexPath:)` 메서드를 호출하여 delegate에 알린다. 이 메서드를 구현하는 것은 선택사항이지만 권장된다. 왜냐하면 테이블 뷰는 드래그 콘텐츠의 통합 방법에 대한 시각적 피드백을 표시할 수 있기 때문이다. 구현시 지정된 인덱스 경로에서 드랍에 대응하는 메서드에 대한 정보가 포함된 `UITableViewDropProposal` 객체를 생성하라. 예를 들어, 컨텐츠를 데이터 소스에 새 행으로 삽입하거나 지정된 인덱스 경로에 있는 기존 행에 데이터를 추가할 수 있다. 메서드는 자주 호출되므로 가능한 빨리 proposal을 리턴하라. 이 메서드를 구현하지 않으면 테이블 뷰가 드랍을 처리하는 메서드에 대한 시각적 피드백을 제공하지 않는다.

사용자가 화면에서 손가락을 들어 드랍을 커밋하는 경우, 테이블 뷰는 드랍 델리게이트의 `tableView(_:performDropWith:)` 메서드를 호출한다. 삭제된 데이터를 처리하려면 이 메서드를 구현해야 한다. 드래그한 데이터를 가져오고 테이블 뷰의 데이터 소스를 업데이트하고 필요한 행을 테이블 뷰 자체에 삽입하라. 콘텐츠가 테이블 뷰에서 생성된 경우 현재 위치에서 드래그한 행을 삭제하고 기존 테이블 뷰 API를 사용하여 새 위치에 삽입할 수 있다. 테이블 뷰 외부에서 가져온 콘텐츠의 경우 `localObject` 프로퍼티\(앱 내부에서 생성된 콘텐츠의 경우\) 또는 `NSItemProvider` 객체를 사용하여 데이터를 가져오고 삽입하라.

`tableView(_:performDropWith:)` 메서드를 구현에서 다음을 수행하라.

1. 제공된 드랍 코디네이터 객체의 항목 프로퍼티를 반복하라.
2. 각 항목에 대해 해당 내용을 처리하는 방법을 결정한다.
   * 항목의 `sourceIndexPath`에 값이 포함되어 있는 경우 항목이 테이블 뷰에서 시작된다. 배치 업데이트를 사용하여 항목을 현재 위치에서 삭제하고 새인덱스 경로에 삽입하라.
   * 드래그 항목의 `localObject` 프로퍼티가 설장된 경우, 컨텐츠는 앱의 다른 곳에서 생성되므로 행을 삽입하거나 기존 항목을 업데이트해야 한다.
   * 다른 옵션을 사용할 수 없는 경우 드래그 항목의 `itemProvider` 프로퍼티에 `NSItemProvider` 를 사용하여 데이터를 비동기식으로 가져오고 항목을 삽입하거나 업데이트하라.
3. 데이터 소스를 업데이트하고 테이블 뷰에 필요한 항목을 삽입하거나 이동하라.

앱에 이미 로컬인 콘텐츠의 경우 일반적으로 테이블 뷰의 데이터 소스 및 인터페이스를 직접 업데이트할 수 있다. 예를 들어, 배치 업데이트를 사용하여 테이블 뷰 내에서 드래그한 행을 삭제한 다음 삽입할 수 있다. 완료되면 드랍 코디네이터의 `drop(_:toRowAt:)` 메서드를 호출하여 드래그한 내용을 테이블 뷰로 애니메이션과 함께 삽입하라.

`NSItemProvider` 객체를 사용하여 검색해야 하는 데이터의 경우 실제 데이터를 검색할 수 있을 때까지 테이블 뷰에 placeholder를 삽입하라. 테이블 뷰에 새 행을 삽입할 때만 placeholder를 삽입하면 된다. placeholder는 실제 데이터를 사용할 수 있을 때까지 표시할 기본 내용을 표시하는 임시 행 역할을 한다. 예를 들어 콘텐츠가 현재 로드 중임을 나타내는 텍스트 필드가 있는 placeholder 행을 제공할 수 있다.

테이블 뷰에 placeholder를 삽입하려면 다음을 수행하라.

1. `UITableView DropCoordinator` 객체의 `drop(_:toPlaceholderInsertedAt:withReuseIdentifier:rowHeight:cellUpdateHandler:)` 메서드를 호출하여 테이블 뷰의 행에 placeholder를 삽입하라. `cellUpdateHandler` 매개 변수의 블록을 사용하여 placeholder 셀의 내용을 구성하라.
2. `NSItemProvider` 객체에서 데이터를 비동기식으로 로드하기 시작하라.

`NSItemProvider` 객체가 실제 데이터를 반환하면 삽입을 수행하고 placeholder 셀을 최종 셀로 교환하라. 특히 placeholder를 만든 후 받은 컨텍스트 객체의 `commitInsertion(dataSourceUpdates:)` 메서드를 호출하라. 이 메서드로 전달된 블록에서 모델 객체와 테이블 뷰 데이터 소스를 업데이트하라. 이 메서드가 반환되면 테이블 뷰는 자동으로 placeholder를 삭제하고 마지막 행을 삽입하므로 업데이트된 데이터가 드랍 코디네이터의 destinationIndexPath 프로퍼티에 지정된 해당 위치에 새로운 cellInsert placeholders에 반영된다.

