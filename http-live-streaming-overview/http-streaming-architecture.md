# HTTP Streaming Architecture

HTTP Live Streaming은 암호화 및 인증 지원으로 일반 웹 서버에서 iOS 3.0 이상을 실행하는 장치\(아이패드 및 애플 TV 포함\) 또는 사파리 4.0 이상이 설치된 컴퓨터로 라이브 또는 사전 녹화된 오디오 및 비디오를 전송할 수 있다.

### Overview

개념적으로 HTTP Live Streaming은 서버 구성요소, 배포 구성요소, 클라이언트 소프트웨어의 세 부분으로 구성된다.

**서버 컴포넌트**는 미디어의 입력 스트림을 취하여 디지털로 인코딩하고, 전달에 적합한 형식으로 캡슐화하며, 캡슐화된 미디어를 배포할 수 있도록 준비하는 일을 담당한다.

**배 컴포넌트**는 표준 웹 서버로 구성되어 있다. 고객 요청을 수락하고 준비된 미디어 및 관련 리소스를 고객에게 제공할 책임이 있다. 대규모 배포를 위해서는 엣지 네트워크나 다른 컨텐츠 전달 네트워크도 사용할 수 있다.

**클라이언트 소프트웨어**는 요청할 적절한 미디어를 결정하고, 해당 리소스를 다운로드한 다음, 연속적인 스트림으로 미디어를 사용자에게 제공할 수 있도록 재조립할 책임이 있다. iOS 3.0 이상에 클라이언트 소프트웨어가 포함되고 Safari 4.0 이상이 설치된 컴퓨터에 설치된다.

일반적인 구성에서 하드웨어 인코더는 오디오-비디오 입력을 받아 H.264 비디오와 AAC 오디오로 인코딩한 후 MPEG-2 Transport Stream 결과물을 만들고 이것을 소프트웨어 스트림 세그먼트에 의해 일련의 짧은 미디어 파일로 분할한다. 이 파일들은 웹 서버에 저장된다. 또한 세그멘터는 미디어 파일 목록을 포함하는 인덱스 파일을 생성하고 유지 관리한다. 인덱스 파일의 URL은 웹 서버에 게시된다. 클라이언트 소프트웨어는 인덱스를 읽은 다음 나열된 미디어 파일을 순서대로 요청하여 세그먼트 사이의 공백이나 공백 없이 표시한다.

간단한 HTTP 스트리밍 구성의 예는 Figure 1-1에 나타나 있다.

**Figure 1-1**  A basic configuration

![](../.gitbook/assets/transport_stream_2x%20%281%29.png)

입력은 녹화 또는 사전 기록된 소스에서 이루어질 수 있다. 일반적으로 MPEG-4 \(H.264 비디오 및 AAC 오디오\)로 인코딩되며, 기성 하드웨어를 통해 MPEG-2 전송 스트림에 패키징된다. 그런 다음 MPEG-2 전송 스트림을 세그먼트로 분할하여 하나 이상의 `.ts` 미디어 파일로 저장한다. 이는 일반적으로 애플 스트림 세그멘터와 같은 소프트웨어 도구를 사용하여 수행된다.

오디오 전용 스트림은 ADTS 헤더가 있는 AAC, MP3 또는 AC-3으로 포맷된 MPEG 기본 오디오 파일 시리즈가 될 수 있다.

세그멘터는 또한 인덱스 파일도 생성한다. 인덱스 파일에는 미디어 파일 목록이 포함되어 있다. 인덱스 파일은 또한 메타데이터를 포함한다. 인덱스 파일은 `.M3U8` 재생 목록이다. 인덱스 파일의 URL은 클라이언트가 접근한 다음 인덱스된 파일을 순차적으로 요청한다.

### Server Components

서버는 기성 하드웨어를 사용할 수 있는 미디어 인코더를 필요로 하며, 인코딩된 미디어를 세그먼트로 분할하여 파일로 저장할 수 있는 방법이 필요하며, 이는 애플이 제공하는 미디어 스트림 세그멘터와 같은 소프트웨어이거나 통합 타사 솔루션의 일부일 수 있다.

#### Media Encoder

미디어 인코더는 오디오 비디오 장치에서 실시간 신호를 수신하여 미디어를 인코딩하고 전송을 위해 캡슐화한다. 인코딩은 H.264 비디오 및 HE-AAC 오디오와 같은 클라이언트 장치에서 지원하는 형식으로 설정해야 한다. 현재 지원되는 전송 형식은 오디오-비디오를 위한 MPEG-2 전송 스트림 또는 오디오 전용의 MPEG 기본 스트림이다.

인코더는 MPEG-2 전송 스트림에 인코딩된 미디어를 로컬 네트워크를 통해 스트림 세그멘터로 전송한다. MPEG-2 전송 스트림을 MPEG-2 비디오 압축과 혼동하지 말아라. 전송 스트림은 여러 가지 다른 압축 형식과 함께 사용할 수 있는 패키징 포멧이다. 지원되는 압축 형식은 오디오 기술 및 비디오 기술 목록이다.

> **중요**: 비디오 인코더는 스트림을 인코딩하는 도중에 비디오 규모나 코덱 유형과 같은 스트림 설정을 변경해서는 안된다. 스트림 설정이 불가피할 경우 세그멘트 경계에서 설정을 변경해야 하며 `EXT-X-DISCONTINUITY` 태그를 다음 세그먼트에 설정해야 한다.

#### Stream Segmenter

스트림 세그멘터는 로컬 네트워크에서 전송 스트림을 읽고 동일한 기간의 일련의 작은 미디어 파일로 분할하는 기능을 하는 프로세스이다. \(일반적으로 소프트웨어\) 각 세그먼트가 별도의 파일에 있더라도 비디오 파일은 매끄럽게 재구성할 수 있는 연속 스트림에서 만들어진다.

또한 세그멘터는 개별 미디어 파일에 대한 참조를 포함하는 인덱스 파일을 생성한다. 세그멘터가 새 미디어 파일을 완료할 때마다 인덱스 파일이 업데이트 된다. 인덱스는 미디어 파일의 가용성 및 위치를 추적하는데 사용된다. 세그멘터는 또한 각 미디어 세그먼트를 암호화하여 프로세스의 일부로 키 파일을 생성할 수도 있다.

미디어 세그먼트는 `.ts` 파일로 저장된다 \(MPEG-2 전송 스트림 파일\). 인덱스 파일은 `.M3U8` 재생 목록으로 저장된다.

#### File Segmenter

이미 지원되는 코덱을 사용하여 인코딩된 미디어 파일이 있는 경우 파일 세그멘터를 사용하여 MPEG-2 전송 스트림에 캡슐화하여 동일한 길이의 세그먼트로 분할할 수 있다. 파일 세그멘터는 HTTP Live Streaming을 통해 주문형 비디오를 전송하기 위해 기존의 오디오 및 파일의 라이브러리를 사용할 수 있게 해준다. 파일 세그멘터는 스트림 세그멘트와 동일한 작업을 수행하지만 스트림 대신 파일을 입력으로 가져간다.

### Media Segment Files

미디어 세그먼트 파일은 일반적으로 인코더의 입력에 기초하여 스트림 세그먼트에 의해 생성되며, H.264 비디오와 AAC, MP3 또는 AC-3 오디오를 전달하는 MPEG-2 전송 스트림을 포함하는 일련의 `.ts` 파일로 구성된다. 오디오 전용 브로드캐스트의 경우, 세그멘터는 ADTS 헤더가 있는 AAC 오디오를 포함하는 MPEG 기본 오디오 스트림, MP3 오디오 또는 AC-3 오디오를 생산할 수 있다.

### Index Files \(Playlists\)

인덱스 파일은 일반적으로 스트림 세그멘터 또는 파일 세그멘터에서 생성되며 MP3 재생 목록에 사용되는 `.m3u` 형식인 `.M3U8` 재생 목록으로 저장된다.

참고: 인덱스 파일 형식은 .m3u 재생 목록 형식의 확장명이며, 시스템도 `.mp3` 오디오 미디어 파일을 지원하므로 클라이언트 소프트웨어는 인터넷 라디오 스트리밍에 사용되는 일반적인 MP3 재생 목록과도 호환될 수 있다.

`.M3U8` 형태의 매우 간단한 인덱스 파일의 예가 있다. 이는 전체 스트림이 암호화되지 않은 10초짜리 미디어 파일 3개에 포함된 경우 세그멘터가 생성할 수 있다.

```text
#EXT-X-VERSION:3
#EXTM3U
#EXT-X-TARGETDURATION:10
#EXT-X-MEDIA-SEQUENCE:1
 
# Old-style integer duration; avoid for newer clients.
#EXTINF:10,
http://media.example.com/segment0.ts
 
# New-style floating-point duration; use for modern clients.
#EXTINF:10.0,
http://media.example.com/segment1.ts
#EXTINF:9.5,
http://media.example.com/segment2.ts
#EXT-X-ENDLIST
```

정확성을 극대화하기 위해, 프로토콜 버전 3 이상을 지원하는 클라이언트에 재생 목록을 보낼 때 모든 기간을 부동 소수점 값으로 지정해야 한다. \(이전 클라이언트는 정수 값만 지원\) 부동 소수점 길이를 사용할 때는 프로토콜 버전을 지정해야 하며, 버전이 생략되면 재생목록은 프로토콜 버전 1을 준수해야 한다.

> 참고: MPEG-4 비디오나 AAC 또는 MP3 오디오 파일을 소스로 사용하여 다양한 예시 재생 목록을 생성하기 위해 애플이 제공한 파일 세그멘터를 사용할 수 있다. 자세한 내용은 [Media File Segmenter](https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/StreamingMediaGuide/UsingHTTPLiveStreaming/UsingHTTPLiveStreaming.html#//apple_ref/doc/uid/TP40008332-CH102-SW7) 참조.

인덱스 파일에는 암호화 키 파일에 대한 URL과 서로 다른 대역폭에 대한 대체 인덱스 파일도 포함될 수 있다. 인덱스 파일 형식에 대한 자세한 내용은 [HTTP Live Streaming specification](http://tools.ietf.org/html/draft-pantos-http-live-streaming) 의 IETF Internet-Draft를 참조하라.

인덱스 파일은 일반적으로 미디어 세그먼트 파일을 생성하는 동일한 세그멘터에 의해 생성한다. 대체적으로 그들이 공표된 규격에 부합한다면, `.M3U8` 파일과 미디어 세그먼트 파일을 독립적으로 생성할 수 있다. 예를 들어, 오디오 전용 브로드캐스트의 경우, 텍스트 에디터를 사용해 `.MP3` 파일의 연속적인 목록인 `.M3U8` 파일을 만들 수 있다.

### Distribution Components

배포 시스템은 웹 서버 또는 웹 캐싱 시스템으로, HTTP를 통해 클라이언트에 미디어 파일과 인덱스 파일을 전송한다. 컨텐츠를 전송하는 데 사용자 지정 서버 모듈이 필요하지 않으며, 그리고 일반적으로 웹 서버에는 매우 적은 구성이 필요하다.

권장 구성은 일반적으로 MIME-타입 연결을 `.M3U8` 파일 및 `.ts` 파일로 지정하는 것으로 제한된다.

자세한 내용은 [Deploying HTTP Live Streaming](https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/StreamingMediaGuide/DeployingHTTPLiveStreaming/DeployingHTTPLiveStreaming.html#//apple_ref/doc/uid/TP40008332-CH2-SW3) 를 참조하라.

### Client Component

클라이언트 소프트웨어는 스트림을 식별하는 URL을 기반으로 인덱스 파일을 가져오는 것으로 시작된다. 인덱스 파일은 차례로 사용 가능한 미디어 파일, 암호 해독 키 및 사용 가능한 대체 스트림의 위치를 지정한다. 선택한 스트림에 대해 클라이언트는 사용 가능한 각 미디어 파일을 순서대로 다운로드한다. 각 파일에는 스트림의 연속 세그먼트가 포함되어 있다. 충분한 양의 데이터가 다운로드되면, 클라이언트는 재조립된 스트림을 사용자에게 제시하기 시작한다.

클라이언트는 암호 해독 키 가져오기, 인증을 허용하기 위한 사용자 인터페이스 인증 또는 제시, 필요한 경우 미디어 파일 암호 해독 등을 담당한다.

이 프로세스는 클라이언트가 인덱스 파일에서 `#EXT-X-ENDLIST` 태그를 발견할 때 까지 계속된다. `#EXT-X-ENDLIST` 태그가 없다면, 인덱스 파일은 진행 중인 브로드캐스트의 일부분이다. 브로드캐스트가 진행되는 동안 클라이언트는 정기적으로 인덱스 파일의 새 버전을 로드한다. 클라이언트는 업데이트된 인덱스에서 새 미디어 파일 및 암호화 키를 찾고 이러한 URL을 대기열에 추가한다.

